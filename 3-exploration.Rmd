---
title: "Exploration des données"
description: | 
  Cette section présente les données contenues dans le jeu de données. Elle 
  permet notamment de prendre connaissance des statistiques relatives aux 
  différentes variables d'intérêt et de visualiser leur distribution.
date: "`r Sys.Date()`"
# Modifier les détails que vous voulez
author:
  - first_name: "Stéphanie"
    last_name: "Lapierre"
    url: https://github.com/stephanielapierre
    # les champs d'affiliation sont optionnels, vous pouvez les
    # comment out en ajoutant un # devant.
    # affiliation: FAS1002
    # affiliation_url: https://admission.umontreal.ca/programmes/microprogramme-de-1er-cycle-en-analyse-des-megadonnees-en-sciences-humaines-et-sociales/structure-du-programme/
    # changer pour votre propre orcid id
    # https://orcid.org/ pour vous inscrire.
    # orcid_id: 0000-0000-0000-0000
# Changer pour votre propre URL si jamais quelqu'un vous cite!
citation_url: https://fas1002.github.io/FAS1002_projet-final
# Inclure les références que vous utilisez dans vos rapports
# dans un fichier biblio.bib. Je conseille Zotero pour construire
# ce fichier ou d'utiliser le package citr dans RStudio.
# Installation: devtools::install_github("crsh/citr")
bibliography: references.bib
output: distill::distill_article
---

```{r setup, include=FALSE}
source("R/opening-processed-data.R", local = knitr::knit_global())              # Script pour l'ouverture des données traitées
knitr::opts_chunk$set(echo = FALSE)
```

```{r, include=FALSE}
library(tidyverse)
library(lubridate)
library(dplyr)
library(ggplot2)
library(ggthemes)
library(kableExtra)
```

```{r, include=FALSE}
# Jeux de données récentes, avec seulement les pays
df_pays <- filter(df2021, df2021$region == "pays")  
df_pays <- select(df_pays, -c("region"))
# Enlever les pays qui on NA dans continent, (principalement des îles de pays)
df_pays <- df_pays[!is.na(df_pays$continent),]
```

# La vaccination à travers le monde

## Les données les plus récentes
Comme mentionné dans la section Importation et manipulation des données, les 
données sur la vaccination sont disponibles sur une base quotidienne, mais tous 
les pays ne procéde pas à la mise à jour de leurs données avec la même fréquence. 

Commençons par analyser la distribution des pays selon la plus récente 
observation en lien avec la vaccination.

```{r}
ggplot(df_pays, aes(date, fill = continent)) +
  geom_histogram() +
  scale_x_date(name = "Date de l'observation") +
  scale_y_continuous(name = "Fréquence") +
  ggtitle("Distribution des pays selon la plus récente observation") +
  theme_economist() +
  theme(legend.position = "top", legend.direction = "horizontal",
        legend.box = "horizontal",
        legend.key.size = unit(0.6, "cm"),
        plot.title = element_text(family="Tahoma", size = 14),
        text = element_text(family = "Tahoma"),
        axis.title = element_text(size = 10),
        legend.text = element_text(size = 10),
        legend.title= element_blank())
```

En analysant le graphique de la distribution des pays, le premier est que la 
majorité des observations sont datées après le mois de novembre. Il y a 
toutefois quelques pays dont les données les plus récentes se détachent des 
autres. De quel pays s'agit-il?

```{r, include=FALSE}
# Préparation pour les données plus vieilles
old_date <- Sys.Date() %m-% months(1) 
old <- filter(df_pays, df_pays$date < old_date)
old <- select(old, c(1, 3, 4))
old <- arrange(old, old$date)

#Formattage
old <- rename(old, 
                Pays = `name`,
                Continent = `continent`,
                "Observation la plus récente" = `date`)
```

```{r}
old %>%
  kbl() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F)
```


```{r, include=FALSE}
# Préparation pour les données plus plus récente
old_date <- Sys.Date() %m-% months(1) 
new <- filter(df_pays, df_pays$date > old_date)
new <- select(new, c(1, 3, 4))
# Différence entre la date de l'observation et la date du jour
new$difference <- Sys.Date() - new$date
```

Si on exclus les `r nrow(old)` pays qui ont des observations qui datent de plus 
d'un mois, on obtient des observations dont la date varie entre le `r min(new$date)` 
et le `r max(new$date)`, avec le `r mean(new$date)` comme date moyenne. En d'autre 
mots, l'écart varie de `r min(new$difference)` à `r max(new$difference)` jours 
avec une moyenne de `r round(mean(new$difference), 0)` jours. Visuellement, 
voici la distribution : 

```{r}
ggplot(new, aes(date, fill = continent)) +
  geom_histogram() +
  scale_x_date(name = "Date de l'observation") +
  scale_y_continuous(name = "Fréquence") +
  ggtitle("Distribution des pays selon la plus récente observation") +
  theme_economist() +
  theme(legend.position = "top", legend.direction = "horizontal",
        legend.box = "horizontal",
        legend.key.size = unit(0.6, "cm"),
        plot.title = element_text(family="Tahoma", size = 14),
        text = element_text(family = "Tahoma"),
        axis.title = element_text(size = 10),
        legend.text = element_text(size = 10),
        legend.title= element_blank())
```

```{r, include=FALSE}
rm(old, new, old_date)
```


## Les statistiques sur la vaccination

*tableau sommaire des indicateurs de la vaccination*
*on va faire un summarise de chaque variable puis, on fait faire un rowbind pour tout avoir dans un tableau*




```{r, include=FALSE}
max_date <- max(df$date)
df_recent_pays <- filter(df, df$date == max_date)
df_recent_pays <- filter(df_recent_pays, df_recent_pays$region == "pays")
df_recent_pays <- df_recent_pays %>% drop_na(continent)

df_recent_pays <- rename(df_recent_pays, Continent = `continent`)
df_recent_pays$Continent <- str_replace(df_recent_pays$Continent, "_", " ")
df_recent_pays$Continent <- str_to_title(df_recent_pays$Continent)

sommaire <- df_recent_pays %>% summarise(
  "Vaccins administrés" = mean(`total_vaccinations`, na.rm = TRUE),
  "Doses de rappel" = mean(`total_boosters`, na.rm = TRUE),
  "Personnes vaccinées" = mean(`people_vaccinated`, na.rm = TRUE),
  "Personnes pleinement vaccinées" = mean(`people_fully_vaccinated`, na.rm = TRUE),
  "Personnes pleinement vaccinées par 100 hab." = round(mean(`people_fully_vaccinated_per_hundred`, na.rm = TRUE), 1)
)

sommaire2 <- df_recent_pays %>% group_by(df_recent_pays$Continent) %>% summarise(
  "Vaccins administrés" = mean(`total_vaccinations`, na.rm = TRUE),
  "Doses de rappel" = mean(`total_boosters`, na.rm = TRUE),
  "Personnes vaccinées" = mean(`people_vaccinated`, na.rm = TRUE),
  "Personnes pleinement vaccinées" = mean(`people_fully_vaccinated`, na.rm = TRUE),
  "Personnes pleinement vaccinées par 100 hab." = round(mean(`people_fully_vaccinated_per_hundred`, na.rm = TRUE), 1)
)

#Formattage du tableau 
sommaire2 <- rename(sommaire2, Continent = `df_recent_pays$Continent`)
```

Les données les plus récentes contenus dans la base données datent du `r max_date` 
et portent sur `r nrow(df_recent_pays)` pays. Voici un tableau présentant la 
moyenne par pays pour certains indicateurs.

**Données sur la vaccination, moyenne par pays, `r max_date`**
```{r}
sommaire %>%
  kbl() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F)
```

Afin de tenir compte des particularités entre les différentes régions du monde voici le même tableau dans lequel les pays sont regroupés par continent.

**Données sur la vaccination, moyenne par continent, `r max_date`**
```{r}
sommaire2 %>%
  kbl() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F)
```

Déjà avec ce tableau, il est possible de constater que les données varient 
beaucoup d'un continent à l'autre. Mais qu'en est-il si un prend les données 
des différents pays à l'intérieur d'un continent. 

Observons maintenant la distribution des pays selon la variable Personnes pleinement vaccinées par 100 habitants.

```{r}
ggplot(df_recent_pays) +
  aes(x = Continent, y = people_fully_vaccinated_per_hundred) +
  geom_boxplot(shape = "circle") +
  geom_jitter(position = position_jitter(width = 0.1, height = 0), alpha = 1/4, color = "#440154") +
  labs(
    x = "Continent",
    y = "Personnes pleinements vaccinées par 100 habitants",
    title = "Distribution des personnes pleinements vaccinées par 100 habitants"
  ) +
  theme_light() +
   theme(plot.title = element_text(face = "bold"))
```

Ce graphique de boîtes à moustaches illustre bien la distribution des pays à
l'intérieur des continents. L'Afrique, l'Asie et l'Europe se démarquent avec des 
pays qui qui se retrouve répartie sur toute la distribution. 


## Et nos autres variables...

```{r, include=FALSE}
df2021_clean <- filter(df2021, df2021$region == "pays")
df2021_clean <- df2021_clean %>% drop_na(continent)

df2021_clean <- rename(df2021_clean, Continent = `continent`)
df2021_clean$Continent <- str_replace(df2021_clean$Continent, "_", " ")
df2021_clean$Continent <- str_to_title(df2021_clean$Continent)

# Population
s_pop <- df2021_clean %>% group_by(df2021_clean$Continent) %>% summarise(
  Médiane = median(`population`, na.rm = TRUE),
  Moyenne = mean(`population`, na.rm = TRUE),
  "Écart type" = sd(`population`, na.rm = TRUE),
  Minimum = min(`population`, na.rm = TRUE),
  Maximum = max(`population`, na.rm = TRUE)
)

# Espérance de vie
s_life <- df2021_clean %>% group_by(df2021_clean$Continent) %>% summarise(
  Médiane = round(median(`life_expectancy`, na.rm = TRUE), 1),
  Moyenne = round(mean(`life_expectancy`, na.rm = TRUE), 1),
  "Écart type" = round(sd(`life_expectancy`, na.rm = TRUE), 1),
  Minimum = round(min(`life_expectancy`, na.rm = TRUE), 1),
  Maximum = round(max(`life_expectancy`, na.rm = TRUE), 1)
)

# PIB
s_pib <- df2021_clean %>% group_by(df2021_clean$Continent) %>% summarise(
  Médiane = round(median(`gdp`, na.rm = TRUE), 1),
  Moyenne = round(mean(`gdp`, na.rm = TRUE), 1),
  "Écart type" = round(sd(`gdp`, na.rm = TRUE), 1),
  Minimum = round(min(`gdp`, na.rm = TRUE), 1),
  Maximum = round(max(`gdp`, na.rm = TRUE), 1)
)

# PIB par habitant
s_pib_capita <- df2021_clean %>% group_by(df2021_clean$Continent) %>% summarise(
  Médiane = round(median(`income_per_person`, na.rm = TRUE), 0),
  Moyenne = round(mean(`income_per_person`, na.rm = TRUE), 0),
  "Écart type" = round(sd(`income_per_person`, na.rm = TRUE), 0),
  Minimum = round(min(`income_per_person`, na.rm = TRUE), 0),
  Maximum = round(max(`income_per_person`, na.rm = TRUE), 0)
)

#Formattage du tableau 
s_pop <- rename(s_pop, Continent = `df2021_clean$Continent`)
s_life <- rename(s_life, Continent = `df2021_clean$Continent`)
s_pib <- rename(s_pib, Continent = `df2021_clean$Continent`)
s_pib_capita <- rename(s_pib_capita, Continent = `df2021_clean$Continent`)
```

Voici les tableaux présentants les statistiques descritives des autres variables 
disponibles dans le jeu de données.

**Données sur la population, moyenne par continent, 2021**
```{r}
s_pop %>%
  kbl() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F)
```

**Données sur l'espérance de vie, moyenne par continent, 2021**
```{r}
s_life %>%
  kbl() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F)
```

**Données sur le PIB réel estimé (G$), moyenne par continent, 2021**
```{r}
s_pib %>%
  kbl() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F)
```

**Données sur le PIB par habitant estimé, moyenne par continent, 2021**
```{r}
s_pib_capita %>%
  kbl() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F)
```





### Statistiques descritives des données de 2021

```{r, include=FALSE}
summary(df2021)

pop_pays <- filter(df2021, df2021$region == "pays")
sum_pop <- pop_pays %>% summarise(
  Moyenne = mean(`population`, na.rm = TRUE),
  Médiane = median(`population`, na.rm = TRUE),
  Minimum = min(`population`, na.rm = TRUE),
  Maximum = max(`population`, na.rm = TRUE))

pop_continent <- filter(df2021, df2021$region == "continent")
sum_pop <- pop_continent %>% summarise(
  Moyenne = mean(`population`, na.rm = TRUE),
  Médiane = median(`population`, na.rm = TRUE),
  Minimum = min(`population`, na.rm = TRUE),
  Maximum = max(`population`, na.rm = TRUE))

summary(df)
```




## Un peu d'interactivité pour le plaisir!

```{r map, layout = "l-page"}
library(leaflet)
leaflet() %>%
  addTiles() %>%
  addMarkers(lng=174.768, lat=-36.852, popup="Là où R est né") %>%
  addProviderTiles(providers$Stamen.Watercolor)
```


## Peut-être que ça vous inspirera!

```{r plotly}
library(plotly)
library(gapminder)
df <- gapminder

fig <- df %>%
  plot_ly(
    x = ~ gdpPercap,
    y = ~ lifeExp,
    size = ~ pop,
    color = ~ continent,
    frame = ~ year,
    text = ~ country,
    hoverinfo = "text",
    type = 'scatter',
    mode = 'markers',
    width = "100%",
    height = 600
  )

fig <- fig %>% layout(xaxis = list(type = "log"))

fig <- fig %>%
  animation_button(
    x = 0, xanchor = "left", y = -0.15, yanchor = "bottom"
  )

fig
```


