---
title: "Importation et manipulation des données"
description: | 
  Cette section présente les données utilisées dans ce rapport ainsi que les 
  manipulations qui ont été nécessaire pour préparer les données aux analyses
date: "`r Sys.Date()`"
# Modifier les détails que vous voulez
author:
  - first_name: "Stéphanie"
    last_name: "Lapierre"
    url: https://github.com/stephanielapierre
    # les champs d'affiliation sont optionnels, vous pouvez les
    # comment out en ajoutant un # devant.
    # affiliation: FAS1002
    # affiliation_url: https://admission.umontreal.ca/programmes/microprogramme-de-1er-cycle-en-analyse-des-megadonnees-en-sciences-humaines-et-sociales/structure-du-programme/
    # changer pour votre propre orcid id
    # https://orcid.org/ pour vous inscrire.
    # orcid_id: 0000-0000-0000-0000
# Changer pour votre propre URL si jamais quelqu'un vous cite!
citation_url: https://fas1002.github.io/FAS1002_projet-final
# Inclure les références que vous utilisez dans vos rapports
# dans un fichier biblio.bib. Je conseille Zotero pour construire
# ce fichier ou d'utiliser le package citr dans RStudio.
Installation: devtools::install_github("crsh/citr")
bibliography: references.bib
output: distill::distill_article
---

```{r setup, include=FALSE}
source("R/data-download.R", local = knitr::knit_global())             # Script pour le téléchargement des données
source("R/opening-data.R", local = knitr::knit_global())              # Script pour l'ouverture et le traitement des données
source("R/merge-data.R", local = knitr::knit_global())                # Script pour la fusion des données
knitr::opts_chunk$set(echo = FALSE)
```

```{r, include=FALSE}
library(tidyverse)
library(readxl)
library(dplyr)
library(kableExtra)
```

Vous pouvez maintenant importer et travailler sur vos données, comme celles de @mathieu2021.

# Données utilisées
TO DO : Ajouter une présentation des sources de données et des données utiliser.

Finir avec une HEAD de la base merger


# Importation et traitement de données



# Jeux de données
On va commencer par constituer une base de données pour 2021

- Comme les données sur la vaccination sont quotidionnes et qu'il y a certain délais pour certains pays, les données datant d'il y a un mois sont utilisées 
```{r, include=FALSE}
month <- Sys.Date() - months(1)
df2021 <- filter(df, df$date == month)
```

TO DO : TÉLÉCHARGEMENT DES DONNÉES


# Variable continent? - Comment présenter?

# Validité des valeurs
Afin de vérifier la validité des valeurs, on compare la valeur de la variable `total_vaccinations_per_hundred` qui est fourni par Our World in Data avec une nouvelle variable qu'on obtient en prenant la population de 2021 estimé par Gapminder.

```{r, include=FALSE}
# Subset pour simplifier le jeu de données (on enleve des variables)
df_vac_100hab <- select(df2021, c("name", "region", "total_vaccinations_per_hundred", "total_vaccinations", "population"))

# Calcul la nouvelle variable
df_vac_100hab$calcul <- df_vac_100hab$total_vaccinations/df_vac_100hab$population*100     # Calcul la variable
df_vac_100hab$calcul <- round(df_vac_100hab$calcul, 2)                  # Arrondie pour garder 2 décimales

# On ajoute fait la comparaison entre la variable existante et calculée
df_vac_100hab <- df_vac_100hab %>% mutate("match" = ifelse(total_vaccinations_per_hundred == calcul, "Correct","Incorrect"))

# Sommaire
df_vac_100hab$match <- as.factor(df_vac_100hab$match)

# On extrait les données Correct et les NA (pour l'analyse)
correct <- filter(df_vac_100hab, df_vac_100hab$match == "Correct")
na <- filter(df_vac_100hab, is.na(df_vac_100hab$match))

# On extrait les données Incorrect
incorrect <- filter(df_vac_100hab, df_vac_100hab$match == "Incorrect")
incorrect <- select(incorrect, "name", "region", "total_vaccinations_per_hundred", "calcul")

# On calcule la différence si les données sont Incorrect
incorrect$difference <- incorrect$total_vaccinations_per_hundred - incorrect$calcul
incorrect$difference <- abs(incorrect$difference)
incorrect <- arrange(incorrect, incorrect$difference)
```

Le jeux de données de données de 2021 contient `r nrow(df_vac_100hab)` observations (des pays ou des continents).

Il faut d'abord noter qu'il n'est pas possible d'effectuer de comparaison pour `r nrow(na)` observations. Ceci est le résultat de valeurs manquantes pour le vaccination ou la population. 

Pour `r nrow(correct)` des observations, il n'y a pas de différence entre la valeur de la variable `total_vaccinations_per_hundred` de Our World in Data et celle calculées. Alors que pour `r nrow(incorrect)` observations, il y a une différence entre la valeur de OWID et la valeur calculée.

Voici le tableau qui présente les `r nrow(incorrect)` pays ou continents pour lesquels 
le taux de vaccination par 100 habitants de Our World In Data est différent que celui qui est calculé.

```{r}
incorrect %>%
  kbl() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F)
```

En considérant que le nombre de pays ou de continent qui présente une valeur différente est petit, il est possible de conclure que les données sont valides.

```{r, include=FALSE}
source("R/processed-data.R", local = knitr::knit_global())             # Script pour enregistrer les données
```
